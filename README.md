# tl-ninjarmm

This is a Python library for the NinjaRMM API that is autogenerated from NinjaRMM's OpenAPI spec using [OpenAPI Generator](https://openapi-generator.tech/).

## Features

- **Automatic OAuth2 Token Refresh**: The library automatically handles OAuth2 authentication and token refresh using `requests_oauthlib.OAuth2Session`
- **OpenAPI Generated**: Automatically generated from the official NinjaRMM OpenAPI specification

## OAuth2 Authentication

The library supports automatic OAuth2 token refresh using the client credentials flow. When you configure the API client with `client_id` and `client_secret`, it will:

1. Automatically fetch the initial access token
2. Include the Bearer token in all API requests
3. Automatically refresh the token when it expires
4. Update the configuration with the new token

### Example Usage

```python
from src.tl_ninjarmm.configuration import Configuration
from src.tl_ninjarmm.api_client import ApiClient
from src.tl_ninjarmm.api.system_api import SystemApi

# Configure with OAuth2 credentials
config = Configuration(
    host="https://your-ninja-instance.com",
    client_id="your_client_id",
    client_secret="your_client_secret",
    token_scope="monitoring"  # Optional
)

# Create API client with automatic token refresh
api_client = ApiClient(configuration=config)
system_api = SystemApi(api_client=api_client)

# Make API calls - tokens are automatically refreshed when needed
devices = system_api.get_devices(page_size=10)
activities = system_api.get_activities(page_size=10)
alerts = system_api.get_alerts()
```

The implementation uses the same pattern as the `requests_oauthlib.OAuth2Session`:

```python
from requests_oauthlib import OAuth2Session
oauth = OAuth2Session(client_id, token=token, auto_refresh_url=refresh_url,
    auto_refresh_kwargs=extra, token_updater=token_saver)
r = oauth.get(protected_url)
```

The `ApiClient` automatically:
- Sets up the OAuth2Session with `auto_refresh_url` and `token_updater`
- Uses the session for all HTTP requests when OAuth2 is configured
- Falls back to the original `urllib3` implementation for non-OAuth2 requests

## Testing

The library includes a comprehensive test suite to ensure reliability and performance:

### Running Tests

```bash
# Run all tests
pytest
```

## Generating the library

### From the Current YAML
Run the following command to generate the library:
```
# from the devcontainer
./scripts/generate_python_sdk.sh
```

### From a New Download 
From the export dropdown in the top right at [this page](https://app.ninjarmm.com/apidocs-beta/core-resources), download the bundled references version.
Then, from that version, run the following from the repo root to generate the library:
```
# from the devcontainer
./scripts/generate_python_sdk.sh
```